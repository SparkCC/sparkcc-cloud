version: '3.8'

services:
  web-proxy:
    image: jwilder/nginx-proxy
    container_name: web-proxy
    restart: unless-stopped
    ports:
      - '80:80'
      - '443:443'
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - proxy-certs:/etc/nginx/certs:ro
      - proxy-vhosts:/etc/nginx/vhost.d
      - proxy-html:/usr/share/nginx/html
      - proxy-dhparam:/etc/nginx/dhparam
      - proxy-conf:/etc/nginx/conf.d
  web-proxy-acme:
    image: nginxproxy/acme-companion
    container_name: web-proxy-acme
    restart: unless-stopped
    volumes_from:
      - web-proxy
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - proxy-certs:/etc/nginx/certs:rw
      - proxy-acme:/etc/acme.sh
  watchtower:
    image: v2tec/watchtower
    container_name: watchtower
    restart: unless-stopped
    command: --interval 30 --label-enable
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
  membermatters:
    image: membermatters/membermatters:latest
    container_name: membermatters
    restart: unless-stopped
    ports:
      - '8004:8000'
    volumes:
      - 'membermatters:/usr/src/data'
    environment:
      - PORTAL_DOMAIN=https://members.sparkcc.org
      - PORTAL_ENV=Production
      - VIRTUAL_HOST=members.sparkcc.org
      - LETSENCRYPT_HOST=members.sparkcc.org
      - LETSENCRYPT_EMAIL=admin@sparkcc.org
#  sparkcc-wiki-db:
#    image: mongo
#    container_name: sparkcc-wiki-db
#    restart: unless-stopped
#    ports:
#      - '27017:27017'
#    command: '--smallfiles --logpath=/dev/null'
#    environment:
#      - 'MONGO_LOG_DIR=/dev/null'
#    volumes:
#      - sparkcc-wiki-db-data:/data/db
#  sparkcc-wiki:
#    image: 'requarks/wiki:latest'
#    container_name: sparkcc-wiki
#    restart: unless-stopped
#    links:
#      - sparkcc-wiki-db
#    depends_on:
#      - sparkcc-wiki-db
#    ports:
#      - '8001:3000'
#    environment:
#      - WIKI_ADMIN_EMAIL=admin@sparkcc.org
#      - VIRTUAL_HOST=wiki.sparkcc.org
#      - LETSENCRYPT_HOST=wiki.sparkcc.org
#      - LETSENCRYPT_EMAIL=admin@sparkcc.org
#    volumes:
#      - sparkcc-wiki-data:/data
#      - sparkcc-wiki-repo:/repo
#      - /data/sparkcc-wiki/config/config.yml:/var/wiki/config.yml
  sparkcc-www:
    image: amorphic/sparkcc-web:latest
    container_name: sparkcc-www
    restart: unless-stopped
    ports:
      - "8003:80"
    environment:
      - VIRTUAL_HOST=www.sparkcc.org,sparkcc.org
      - LETSENCRYPT_HOST=www.sparkcc.org,sparkcc.org
      - LETSENCRYPT_EMAIL=admin@sparkcc.org

volumes:
  proxy-certs:
  proxy-vhosts:
  proxy-html:
  proxy-dhparam:
  proxy-conf:
  proxy-acme:
  membermatters:
  #sparkcc-wiki-data:
  #sparkcc-wiki-repo:
  #sparkcc-wiki-db-data:
